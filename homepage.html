<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css"
    integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css"
    integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous">
  </script>

  <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-analytics.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-storage.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-firestore.js"></script>

  <script src="index.js"></script>
  <link rel="stylesheet" href="css/style.css">

  <title>Home</title>
</head>

<body>
  <!-- START HERE -->
  <nav class="navbar navbar-expand-md navbar-dark px-3 bg-yellow sticky-top">
    <div class="container">
      <a href="homepage.html" class="navbar-brand"> College Events</a>
      <button class="navbar-toggler" data-toggle="collapse" data-target="#navBarCollapse">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navBarCollapse">
        <ul class="navbar-nav">
          <li class="nav-item px-2">
            <a href="homepage.html" class="nav-link active"> Home</a>
          </li>
          <li class="nav-item px-2">
        </ul>

        <ul class="navbar-nav ml-auto text-white">

          <li class="navbar-item mr-5">
            <a href="create-events.html" id="logOutButton" class="btn btn-outline-light">
              <i class="fas fa-plus">Add an Event</i></a>
          </li>


          <li class="navbar-item dropdown mr-3 ">

            <!-- href="#": a if you put that txt will hide -->
            <a class="navbar-link dropdown-toggle" data-toggle="dropdown">
              <i class="fa fa-user"></i> Welcome
            </a>
            <div class="dropdown-menu">
              <a href="waitlist.html" class="dropdown-item">
                <i class="fas fa-hourglass"></i> Waitlist
              </a>
              <a href="ChangeAccountInform.html" class="dropdown-item">
                <i class="fa fa-user-circle"></i> Change account info
              </a>
              <a href="ChangePassword.html" class="dropdown-item">
                <i class="fa fa-cog"></i> Change Password
              </a>
              <a href="ChangingEmail.html" class="dropdown-item">
                <i class="far fa-envelope"></i> Change email
              </a>
              <a href="javascript:logout()" id="logOutButton" class="btn btn-outline-light text-danger mr-3"><i
                  class="fa fa-user-times">Logout</i></a>
            </div>

          </li>
        </ul>
      </div>
    </div>

  </nav>

  <section>
    <div class="container">
      <div class="row">
        <div class="col-lg-3 text-white">
          <div class="card my-3 bg-success text-center block">
            <div class="card-body p-5">
              <a href="create-events.html" class="text-white h5"><i class="fas fa-plus pr-1"></i>Add an Event</a>
            </div>
          </div>
          <div class="card my-3 bg-primary text-center block">
            <div class="card-body p-5">
              <a href="homepage.html" class="text-white h5"><i class="fas fa-eye pr-1"></i>View my profile</a>
            </div>
          </div>

        </div>

        <div id="mainEventContent" class="col-lg-9">
          <div class="circularProgressIndicator my-5 justify-content-center mx-auto"></div>

          <!-- <div class="card my-3">
            <img class="card-img-top"
              src="https://wreg.com/wp-content/uploads/sites/18/2020/08/hypatia-h_e789ddcf16e033beefc48a57b0585829-h_05be6b7fa913f643818ab7b0ffcfb5e4.jpg?w=1600&h=1067&crop=1"
              alt="Card image cap">
            <div class="card-body">
              <h5 class="card-title display-4">Event Name</h5>
              <p class="card-text"> eveniet aliquam iste necessitatibus nobis, quo exercitationem in doloribus
                corrupti
                illum perspiciatis dolores itaque totam tenetur odit! Tempore, quidem! Voluptas reiciendis illo
                necessitatibus!</p>
              <p><i class="fas fa-map-marker-alt px-2"></i> 1919 Handa St.</p>
              <p><i class="fas fa-clock px-2"></i> 12/8/2020 at 7pm</p>
              <p><i class="fas fa-phone px-2"></i>315 289 3344</p>
              <p> <strong class="px-2">Capacity:</strong>200</p>
              <p> <strong class="px-2">Available:</strong>200</p>
              <button type="button" class="btn btn-block bg-yellow px-5">Join Event</button>
            </div>
          </div> -->

        </div>
        <button type="button" ><a href="homepage_comment.html">Comment</a></button>
      </div>
    </div>
  </section>

  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
    integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous">
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous">
  </script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous">
  </script>

  <script>
    // if user is logged out then take them back to sign in page(index.html)
    firebase.auth().onAuthStateChanged((user) => {
      if (!user) {
        window.location.href = "index.html";
      }
    });
  </script>

  <script>
    
      // the code below will read the events from the database. For each event event it will create a seperate card to display
      // event data
      const db = firebase.firestore();
      
      db.collection('events').orderBy("eventCreatedDate").limit(10).get().then((querySnapshot) => {
        var eventHtml = "";
        const currentUserId = firebase.auth().currentUser.uid;

        querySnapshot.forEach((doc) => {
          console.log(doc.id, " => ", doc.data());

          const docObj = doc.data();

          console.log(currentUserId);



          var button = "";

          // if the event owner is current logged in user then diplay an "Edit Event" button. Otherwise display "Join Event" button
          if (docObj.owner === currentUserId){
            button = `<button type="button" onclick="goToeditEventPage('${docObj.owner}','${doc.id}')" class="btn btn-block bg-yellow px-5">Edit Event</button>`;
          } else {
            button = `<button type="button" onclick="joinEvent('${doc.id}', '${docObj.owner}', '${docObj.eventName}')" class="btn btn-block bg-yellow px-5">Join Event</button>`;
          }


            // will append this code for each event
          eventHtml += `<div class="card my-3">
            <img class="card-img-top"
              src="${docObj.eventImage}"
              alt="Card image cap">
            <div class="card-body">
              <h5 class="card-title display-4">${docObj.eventName}</h5>
              <p class="card-text">${docObj.eventDescription}</p>
              <p><i class="fas fa-map-marker-alt px-2"></i>${docObj.eventLocation}</p>
              <p><i class="fas fa-clock px-2"></i>${docObj.eventDateAndTime.toDate()}</p>
              <p><i class="fas fa-phone px-2"></i>${docObj.eventContactNumber}</p>
              <p> <strong class="px-2">Capacity:</strong>${docObj.eventCapacity}</p>
              <p> <strong class="px-2">Available:</strong>${docObj.availableSeats}</p>
              ${button}
            </div>
          </div>
          `;
        });

        // if no event was in database then tell user there are no events.
        if (eventHtml == ""){
          eventHtml = `
          <div class="my-5">
          <h3>No events to show. Add more events then it will be displaye here.
          <a href="./create-events.html">Add events</a></h3>
          </div>
          `
          $("#mainEventContent").html(eventHtml);
        } else{
          $("#mainEventContent").html(eventHtml);
        }
       
      });
    
  </script>

</body>

</html>